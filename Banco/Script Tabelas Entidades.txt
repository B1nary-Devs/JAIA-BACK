
DROP SEQUENCE AUTOINCREMENT_USUARIO_ID;


CREATE SEQUENCE AUTOINCREMENT_USUARIO_ID
START WITH 1
INCREMENT BY 1
NOCACHE;



DROP TABLE USUARIO;


create table usuario (
    USUARIO_ID NUMBER DEFAULT AUTOINCREMENT_USUARIO_ID.NEXTVAL,
    email VARCHAR2(100) CONSTRAINT UQ_USUARIO_Email UNIQUE,
    senha VARCHAR2(150),
    ACESSO VARCHAR2(15),
    CONSTRAINT PK_ID_USUARIO PRIMARY KEY (USUARIO_id)
)



DROP SEQUENCE AUTOINCREMENT_PRESTADOR_ID;

CREATE SEQUENCE AUTOINCREMENT_PRESTADOR_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

DROP TABLE PRESTADOR;

CREATE TABLE Prestador(
    prestador_id NUMBER DEFAULT AUTOINCREMENT_PRESTADOR_ID.NEXTVAL,
    CNPJ VARCHAR2(14) CONSTRAINT UQ_Prestador_CNPJ UNIQUE,
    prestador_nome VARCHAR2(100),
    SEGMENTO_id NUMBER,
    USUARIO_ID NUMBER,
    CONSTRAINT PK_ID_PRESTADOR PRIMARY KEY (prestador_id),
    CONSTRAINT FK_USUARIO_PRESTADOR FOREIGN KEY (USUARIO_ID) 
    REFERENCES USUARIO (USUARIO_ID)
);

DROP SEQUENCE AUTOINCREMENT_SEGMENTO_ID;

CREATE SEQUENCE AUTOINCREMENT_SEGMENTO_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

DROP TABLE SEGMENTO;

CREATE TABLE SEGMENTO (
    SEGMENTO_id NUMBER DEFAULT AUTOINCREMENT_SEGMENTO_ID.NEXTVAL,
    SEGMENTO_nome VARCHAR2(100)  CONSTRAINT UQ_SEGMENTO_NOME UNIQUE, 
    CONSTRAINT PK_SEGMENTO_NOME PRIMARY KEY (SEGMENTO_id)
);

ALTER TABLE Prestador
ADD CONSTRAINT FK_PRESTADOR_Checklist
FOREIGN KEY (SEGMENTO_id) REFERENCES SEGMENTO (SEGMENTO_id);


CREATE SEQUENCE AUTOINCREMENT_SOLICITACAO_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE TABLE Solicitacao (
    solicitacao_id NUMBER DEFAULT AUTOINCREMENT_SOLICITACAO_ID.NEXTVAL,
    descricao_solicitacao VARCHAR2(150),
    resultado VARCHAR2(100),
    nome_empresa VARCHAR2(150),
    cnpj_empresa VARCHAR2(15),
    SEGMENTO_id NUMBER,
    CONSTRAINT PK_SOLICITACAO_ID PRIMARY KEY (solicitacao_id),
    CONSTRAINT FK_SEGMENTO_SOLICITACAO_FK FOREIGN KEY (SEGMENTO_id) 
    REFERENCES SEGMENTO (SEGMENTO_id)
);



DROP SEQUENCE AUTOINCREMENT_CHECKLIST_ID;

CREATE SEQUENCE AUTOINCREMENT_CHECKLIST_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

DROP TABLE Checklist;

CREATE TABLE Checklist (
    checklist_id NUMBER DEFAULT AUTOINCREMENT_CHECKLIST_ID.NEXTVAL,
    checklist_nome VARCHAR2(150),
    CONSTRAINT PK_CHECKLIST_ID PRIMARY KEY (CHECKLIST_ID)
);

DROP TABLE relacao_SEGMENTO_checklist;

CREATE TABLE relacao_SEGMENTO_checklist (
    SEGMENTO_id NUMBER,
    checklist_id NUMBER,
    CONSTRAINT FK_Relacao_SEGMENTO_Checklist_SEGMENTO FOREIGN KEY (SEGMENTO_id) 
    REFERENCES SEGMENTO (SEGMENTO_id),
    CONSTRAINT FK_Relacao_SEGMENTO_Checklist_Checklist
    FOREIGN KEY (checklist_id) REFERENCES Checklist (checklist_id)
);

DROP SEQUENCE AUTOINCREMENT_CLIENTE_ID;

CREATE SEQUENCE AUTOINCREMENT_CLIENTE_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

DROP TABLE CLIENTE;

create table cliente (
    CLIENTE_ID NUMBER DEFAULT AUTOINCREMENT_CLIENTE_ID.NEXTVAL,
    CNPJ VARCHAR2(14) CONSTRAINT UQ_CLIENTE_CNPJ UNIQUE,
    NOME VARCHAR2(150),
    CONSTRAINT PK_ID_CLIENTE PRIMARY KEY (cliente_id)
)


DROP SEQUENCE AUTOINCREMENT_ORDEM_SERVICO_ID;
    
CREATE SEQUENCE AUTOINCREMENT_ORDEM_SERVICO_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

DROP table ordem_servico; 

//ver depois como faz a nao obrigatirop

create table ordem_servico(
    ORDEM_SERVICO_ID NUMBER DEFAULT AUTOINCREMENT_ORDEM_SERVICO_ID.NEXTVAL,
    CLIENTE_ID NUMBER,
    data_abertura DATE DEFAULT SYSDATE,
    data_fechamento DATE,
    DESCRICAO VARCHAR2(150),
    status VARCHAR2(100),
    solicitacao_id NUMBER,
    CONSTRAINT PK_ID_ORDEM_SERVICO PRIMARY KEY (ORDEM_SERVICO_ID),
    CONSTRAINT FK_CLIENTE_ORDEM_SERVICO FOREIGN KEY (CLIENTE_ID) 
    REFERENCES CLIENTE (CLIENTE_ID)
    CONSTRAINT FK_SOLICITACAO_ORDEM_SERVICO FOREIGN KEY (solicitacao_id) 
    REFERENCES solicitacao (solicitacao_id) ON DELETE SET NULL
)

DROP TABLE RELACAO_ORDEM_SERVICO_PRESTADOR;

CREATE TABLE RELACAO_ORDEM_SERVICO_PRESTADOR (
    ORDEM_SERVICO_ID NUMBER,
    PRESTADOR_ID NUMBER,
    CONSTRAINT FK_Relacao_PRESTADOR_ORDEM_SERVICO FOREIGN KEY (ORDEM_SERVICO_ID) 
    REFERENCES ORDEM_SERVICO (ORDEM_SERVICO_ID),
    CONSTRAINT FK_Relacao_ORDEM_SERVICO_PRESTADOR FOREIGN KEY (PRESTADOR_ID) 
    REFERENCES  PRESTADOR (PRESTADOR_ID)
);

DROP SEQUENCE AUTOINCREMENT_CHECKLIST_PERSONALIZADO_ID;

CREATE SEQUENCE AUTOINCREMENT_CHECKLIST_PERSONALIZADO_ID
START WITH 1
INCREMENT BY 1
NOCACHE;

DROP TABLE Checklist_Personalizado;

CREATE TABLE Checklist_Personalizado (
    checklist_personalizado_id NUMBER DEFAULT AUTOINCREMENT_CHECKLIST_PERSONALIZADO_ID.NEXTVAL,
    checklist_personalizado_nome VARCHAR2(150),
    ORDEM_SERVICO_ID NUMBER,
    checklist_personalizado_DESCRICAO VARCHAR2(150),
    CHECKLIST_PERSONALIZADO_OBSERVACAO VARCHAR2(150),
    CHECKLIST_PERSONALIZADO_SITUACAO VARCHAR2(150),
    SEGMENTO_id NUMBER,
    CONSTRAINT FK_CHECKLIST_PERSONALIZADO_SEGMENTO
    FOREIGN KEY (SEGMENTO_id) REFERENCES SEGMENTO (SEGMENTO_id),    
    CONSTRAINT PK_CHECKLIST_personalizado_ID PRIMARY KEY (CHECKLIST_personalizado_ID),
    CONSTRAINT FK_CHECKLIST_ORDEM_SERVICO FOREIGN KEY (ORDEM_SERVICO_ID) 
    REFERENCES ordem_servico (ORDEM_SERVICO_ID)
);